# è¯¾ç¨‹æ¦‚è§ˆ
jupyterã‚’ä½¿ã£ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³åŸºç¤

- 5/27 pandas
- 5/28 
- 6/4
- 6/5 15:00ç™ºè¡¨ 5~7åˆ†

## å‚ç…§url
è€å¸ˆçš„ https://yamakk.com/musabi-db-2022/
[matplotlibä¸­æ–‡](https://www.matplotlib.org.cn/tutorials/#%E5%BA%8F%E8%A8%80)


## æ¨è

https://www.youtube.com/watch?v=Iq9DzN6mvYA

## jupyterçš„ç‰¹å¾
ä¼˜åŠ¿ï¼šmd,visual,sorce çš„ç»„åˆã€‚
ä¾‹å¦‚å†™è®ºæ–‡çš„äººï¼Œå¯ä»¥ç•™ä¸‹æ•°æ®å’Œå®ç°æ–¹æ³•ï¼ˆsorce codeï¼‰ï¼Œè¿™æ ·åˆ«äººä¹Ÿå¯ä»¥å†ç°è‡ªå·±çš„å®éªŒã€‚

# æˆ‘çš„é‚£ä¸ªæ–‡ä»¶å¤¹

è€å¸ˆçš„ç¯å¢ƒ
http://musabidb.yamakk.com/tree/huang_danlei
å¯†ç  kitaka2020

http://localhost/notebooks/huang_dl/01_learn.ipynb

# ä¾å­˜å…³ç³»
ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œæœ€ä¸Šé¢çš„æ˜¯ç¦»æˆ‘ä»¬æœ€è¿‘çš„ï¼Œç›¸å½“äº Processingåœ¨ä¸Šé¢ï¼Œjavaåœ¨ä¸‹é¢ï¼‰
Series, DataFrame
	pandas
		numpy  è®¡ç®—
		Matplotlib ç»˜å›¾

- Matplotlibåº“åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯ç›¸å¯¹åº•å±‚ã€‚åº•å±‚å°±æ„å‘³ç€éœ€è¦æ›´ä¸Šå±‚çš„å·¥å…·æ¥æ§åˆ¶ä¼šæ›´æ–¹ä¾¿ã€‚
-  **Seaborn**ï¼ˆ[seaborn](https://so.csdn.net/so/search?q=seaborn&spm=1001.2101.3001.7020)æ˜¯pythonä¸­çš„ä¸€ä¸ªå¯è§†åŒ–åº“ï¼Œæ˜¯å¯¹matplotlibè¿›è¡ŒäºŒæ¬¡å°è£…è€Œæˆï¼Œæ—¢ç„¶æ˜¯åŸºäºmatplotlibï¼Œæ‰€ä»¥seabornçš„å¾ˆå¤šå›¾è¡¨æ¥å£å’Œå‚æ•°è®¾ç½®ä¸å…¶å¾ˆæ˜¯æ¥è¿‘ï¼‰
- æ•°æ®åˆ†æåº“pandasï¼Œå®ƒçš„ç»˜å›¾åŠŸèƒ½å°±æ˜¯åŸºäºMatplotlibåº“ã€‚
- Serieså’ŒDataFrameæ˜¯Pandasåº“ä¸­ä¸»è¦çš„ä¸¤ç§**æ•°æ®ç»“æ„**ï¼Œéƒ½å†…ç½®äº†plotæ–¹æ³•ï¼Œå¯ä»¥ç»˜åˆ¶å›¾å½¢


# è¯­å¥
## å¼•ç”¨åº“çš„å£°æ˜
```py
from pandas import Series, DataFrame  #å‚¨å­˜æ•°ç»„

%matplotlib inline
import matplotlib.pyplot as plt #ç”»å›¾çš„
import seaborn as sns; sns.set() #ç”»å›¾çš„
import pandas as pd  
import numpy as np # padasåŸºäºå®ƒã€‚ å¯¹æ•°ç»„è¿›è¡Œè¿ç®—
sns.set(font='IPAexGothic') # ğŸ‘€æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹é‡è¦ğŸ¦œ

```


## ğŸ”¹series
åˆ›å»ºæ•°ç»„ï¼Œç”¨åˆ°series
### åˆ›å»º
seriesçš„åŸºæœ¬åˆ›å»ºæ–¹æ³•ï¼š
```
Series([value],index = ['indexName'])
```

```py
from pandas import Series #å¼•ç”¨
import numpy as np

budget = Series([20, 28, 40], 
       index = ['ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆ',
                'ãƒãƒãƒ¼ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆ',
                'ãƒ–ãƒªãƒƒã‚¸ãƒ»ã‚ªãƒ–ãƒ»ã‚¹ãƒ‘ã‚¤']) #æ­¤å¤„å‘½äº†ä¸ªå
```

### è®¡ç®—
numpyå¯ä»¥å¯¹å®ƒè¿›è¡Œè®¡ç®—
```py
budget.mean() #æ±‚å‡å€¼
budget.describe() #åˆ—å‡ºå¸¸ç”¨çš„æ‰€æœ‰æ•°å€¼ï¼Œæ¯”å¦‚å¹³å‡å€¼ï¼Œæœ€å¤§æœ€å°å€¼
budget[budget> budget.mean()] #åé¢çš„[]æ˜¯è¿‡æ»¤å™¨ï¼Œ

```
```py

budget.describe() 
# ä¼šè¿”å›å¦ä¸€ä¸ªserieså¦‚ä¸‹ã€‚å®ƒåŸºäºbudgetè®¡ç®—å¾—å‡ºã€‚
# æœ¬è´¨ä¸Šå°±æ˜¯serieså¯¹è±¡ï¼Œæ‰€ä»¥å¦‚æœèµ‹å€¼ï¼Œä¹Ÿå°†æˆä¸ºä¸€ä¸ªserieså¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨seriesçš„æ–¹æ³•ã€‚


[output]

count      8.000000
mean      63.125000
std       58.045395  #stdæ˜¯æ ‡å‡†å·®
min       11.000000
25%       18.250000
50%       34.000000
75%      114.750000
max      150.000000
dtype: float64

```

### ç­›é€‰

``
è¯­æ³•æ ¼å¼ï¼š ``budget[ ç­›é€‰æ¡ä»¶]`` 

```py
budget[budget > budget.mean()]  # budgetã®å¹³å‡å€¤(63.125000) ã‚ˆã‚Šã‚‚å¤§ãã„ã‚‚ã®ã ã‘ã«çµè¾¼ã¿

Out[204]:
```


### æ›¿æ¢ replace()
seriesè‡ªå¸¦æ›¿æ¢method

```py
df['price'].replace('ãªã—',0)
```


### åº”ç”¨å‡½æ•° apply()
`seriesName.apply(functionName)`

```py
def replace_yen(price):
	price = price.replace('å††','')
	return int(price)

#åº”ç”¨åˆ°æ•´ä¸ªseriesé‡Œã€‚
df['price'].apply(replace_yen)
```


## ğŸ’ dataFrame

### æ‰‹å†™åˆ›å»º
é¡ºåºä¸Šæ¥è¯´ï¼Œè¦å…ˆå†™rowï¼Œå†å†™indexã€‚
ï¼ˆä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä¸èµ‹å€¼çš„è¯ï¼Œå°±æ²¡æœ‰é»˜è®¤çš„indexçš„ä½ç½®ï¼Ÿï¼‰
![[src/img/Pasted image 20220528150125.png]]



### è¯»å–æ–‡ä»¶ç”Ÿæˆ
```py
df = pd.read_csv("tokyo_rain.csv", 
                 encoding='sjis',  # ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’sjisæŒ‡å®š
                 skiprows=5,       # å…ˆé ­5è¡Œã‚’é£›ã°ã™
                 usecols=[0,1],    # ä½¿ã†åˆ—ã¯ 0,1åˆ—
                 names=['date','rain'], #åˆ—ã«åå‰ã‚’ä»˜ã‘ã‚‹
                 index_col=0,      # indexã¯0åˆ—
                 parse_dates=True) #ã€€æ—¥ä»˜ã‚’è‡ªå‹•ã§å¤‰æ›ã™ã‚‹
df.head()
```

æœ‰æ—¶ä¼šå‡ºç°æ— æ³•è§£ç çš„æƒ…å†µï¼Œè§£å†³åŠæ³•æ˜¯ç¡®è®¤ä¸€ä¸‹ç¼–ç æ–¹å¼â†“
[[22_528_533 python å¦‚ä½•ç¡®å®šcsvæ–‡ä»¶çš„ç¼–ç æ–¹å¼]]

### è¯»å–dtframeå†…å®¹
```py
movie['budget'] #è¿”å›çš„æ˜¯series
```


```py
movie[['budget']] #return dataFrame è¿”å›å¸¦ä¸€è¡Œçš„
movie[['budget','boxoffice']] # è¿”å›å¸¦è¿™ä¸¤è¡Œçš„

```
![[src/img/Pasted image 20220528155928.png]]

### æ’åº
å› ä¸ºframeæ¶‰åŠåˆ°äº†å¤šä¸ªseriesï¼Œæ‰€ä»¥å½“ä¸€ä¸ªserieså‘ç”Ÿæ’åˆ—æ—¶ï¼ŒåŠ¿å¿…ä¼šå½±å“ä¸å®ƒå…³è”çš„åˆ«çš„seriesçš„é¡ºåºã€‚
å°±åƒExcelé‡Œæ’åºä¸€æ ·ï¼Œå½“æˆ‘è®©ç¬¬ä¸‰åˆ—æŒ‰æ•°å€¼å¤§å°æ’åˆ—æ—¶ï¼Œç¬¬ä¸€äºŒåˆ—ä¹Ÿä¼šç›¸åº”åœ°éšä¹‹è¢«é‡æ–°æ•´ç†ï¼Œä»¥ä¿æŒæ•°æ®çš„å¯¹åº”ã€‚
ä¾‹å¦‚ï¼š
```py
movie['test'] = movie['boxoffice'] / movie['budget'] * 100 # ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆã§ã‚ã‚‰ã‚ã™ãŸã‚100æ›ã‘ã‚‹
movie.sort_values(['test'], ascending=False) # testé †ã«ä¸¦ã¹æ›¿ãˆ

```

![[src/img/Pasted image 20220528154409.png]]

**æŒ‰æ•°å€¼æ’åº**
```py
dtframeå¯¹è±¡.sort_values(ascending=False)
```

### ç­›é€‰
å¸¸å¸¸ã€resampleã€‘ä¸ã€ç»Ÿè®¡æ–¹æ³•ã€‘ä¸€èµ·æ­é…
```py
xxxx.resample('é¢‘ç‡').sum()
xxxx.resample('é¢‘ç‡').mean() ç­‰ç­‰
```

**æŒ‰ä¸€ä¸ªæœˆç»Ÿè®¡ä¸€æ¬¡**
```py
df.resample('1m').sum().head() # 1ãƒ¶æœˆã”ã¨ã®é™æ°´é‡ã®åˆè¨ˆã‚’å‡ºã™

```

### æ·»åŠ ä¸€åˆ—
ç›´æ¥å£°æ˜å³å¯ï¼Œä¾‹å¦‚
```py
df['hour'] = df.index.hour
```

å°±ä¼šç›´æ¥åœ¨åé¢åŠ ä¸€åˆ—hour
![[src/img/Pasted image 20220528234217.png]]

**è”ç³»æ€»ç»“**
å‰é¢ä¹Ÿæœ‰æè¿‡ï¼Œå¦‚æœå†™äº†
```py
df['rain']
```
è¿™æ ·ä¸€å¥â†‘å·²ç»å­˜åœ¨çš„åˆ—ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªseriesã€‚



### åˆ é™¤ä¸€æ•´åˆ—
ä½¿ç”¨del 
-   åˆ é™¤ä¸€åˆ—**del dfName['rowName']**ã€‚


### åˆ†ç»„groupby
[è®²è§£groupby](https://zhuanlan.zhihu.com/p/101284491)
![[src/img/Pasted image 20220528234412.png]]

### åˆå¹¶
https://www.geeksforgeeks.org/how-to-merge-two-pandas-dataframes-on-index/

å³ä¾¿indexä¸ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡
```py
pd.concat([data1, data2], axis=1)

axis=0è¡¨æ‹¼æ¥æ–¹å¼æ˜¯ä¸Šä¸‹å †å ï¼Œ
å½“axis=1è¡¨ç¤ºå·¦å³æ‹¼æ¥ï¼›

```
åˆå¹¶ä¸¤ä¸ªdataFrame
![[src/img/Pasted image 20220529171432.png]]

	ä½†å‰ææ˜¯indexä¸èƒ½å‡ºç°é‡å¤çš„ï¼ˆæ¯”å¦‚recipe1å‡ºç°äº†ä¸¤æ¬¡é…±æ²¹ï¼‰
	
## heatmap
sns.heatmap(  æœ‰å¾ˆå¤šå‚æ•° )

### å‚æ•°è¯¦è§£
**fmt æ˜¾ç¤ºçš„è¯´æ˜å­—ç¬¦ä¸²æ ¼å¼**
https://stackoverflow.com/questions/54506626/how-to-understand-seaborns-heatmap-annotation-format
>There isn't a clear and quick answer to this at the top of search engine results so I provide simple examples here:
`.1e`Â = scientific notation with 1 decimal point (standard form)
`.2f`Â = 2 decimal places
`.3g`Â = 3 significant figures
`.4%`Â = percentage with 4 decimal places

### æ”¹å˜å¤§å°size
https://www.delftstack.com/zh/howto/seaborn/size-of-seaborn-heatmap/

### rotation

# æ€è€ƒæ€»ç»“
pandasçš„ç©ºå€¼ ä½¿ç”¨ `np.nan`

## ç»˜åˆ¶çš„æ€è·¯
è¦ç”Ÿæˆå¤šç§åˆ†æå›¾è¡¨ï¼ŒåŸºæœ¬æ“ä½œå°±æ˜¯ å…ˆå¤„ç†æ•°æ®ï¼Œå†ç”Ÿæˆå›¾è¡¨ã€‚
å¤„ç†æ•°æ®ï¼ˆç­›é€‰èŒƒå›´->è®¡ç®—æ•°å€¼ï¼‰â€”â€”ç»˜åˆ¶

åŸºæœ¬çš„åŸåˆ™å°±æ˜¯ï¼Œå¦‚æœæƒ³ç”»å‡ºæ¥å°±æ˜¯ç”¨.plot()è¿™ä¸ªmethodã€‚
series,dataFrameçš„å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•,å³ï¼š
`xxxxxx.plot()`


â†“æ‰€ä»¥ä¼šæœ‰å¾ˆå¤šç±»ä¼¼è¿™æ ·çš„å†™æ³•
	ä¸ç®¡å‰é¢å¤šå¤æ‚ï¼Œå…¶å®éƒ½æ˜¯åœ¨åšåŒä¸€ä»¶äº‹æƒ…ï¼šæŒ‰æŸä¸ªé€»è¾‘å¤„ç†æ•°æ®è·å¾—ä¸€ä¸ªdataframeï¼Œå†æŠŠå®ƒç»˜åˆ¶å‡ºæ¥ï¼ˆplotï¼‰


```py
ä¾‹1

df.resample('1w').sum().plot()
# .resample('1w') æ˜¯é‡æ–°é‡‡æ ·. æŒ‰ä¸€å‘¨ä¸€æ¬¡çš„é¢‘ç‡â€”â€”å‰ææ˜¯å‰é¢çš„indexæ˜¯æ—¥æœŸç±»å‹ï¼ˆdatetime64)

```

```py
ä¾‹2
(tokyo.crime / tokyo.population).sort_values(ascending=False).plot('bar', title='çŠ¯ç½ªèªçŸ¥ä»¶æ•°/äººå£')

```



## serieså’ŒdataFrameçš„åŒºåˆ«ä¸å…³ç³»
ä¸€ç»´å’ŒäºŒç»´çš„åŒºåˆ«ã€‚

- serieså°±æ˜¯æ•°ç»„ï¼Œæœ€å¤šå°±æ˜¯ä¸€ä¸€å¯¹åº”çš„ç»“æ„ã€‚1index : 1valueçš„å…³ç³»ã€‚
- dataFrameé¡¾åæ€ä¹‰å¯ä»¥äº§ç”Ÿä¸€ä¸ªâ€œframeâ€çš„æ¦‚å¿µï¼ŒçŸ©é˜µå¯¹åº”çš„å…³ç³»ã€‚å¯ä»¥1indexå¯¹åº”å¤šä¸ªvalueã€‚åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡å¯¹åˆ—åï¼Œæ¥è®¿é—®seriesã€‚



## numpyã®listçš„ä¼˜åŠ¿
```py
output:
array([ 20,  28,  40,  11, 150, 108, 135,  13])
```
å®ƒæ¯”pythonåŸç”Ÿçš„listè¡¨ç°æ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªå»ç¡®è®¤ç±»å‹ã€‚
pythonè™½ç„¶è‡ªç”±ï¼Œä½†æ˜¯è‡ªç”±å¸¦æ¥äº†å¤æ‚ï¼Œå®ƒçš„æ•°ç»„ä¼šæ›´æ…¢ã€‚

ä¸€è¡Œå‘½ä»¤å¯¹æ•´ä¸ªæ•°ç»„ä¸€èµ·è®¡ç®—
ç¼–ç¨‹çš„ä¾¿åˆ©æ€§åœ¨è¿™é‡Œä½“ç°
```py
tscore = ( budget - budget.mean() ) * 10 / budget.std() + 50 # åå·®å€¤ã‚’è¨ˆç®—ã™ã‚‹
tscore.sort_values(ascending=False) # å…ˆå¤§åå°çš„é¡ºåºã€‚
```
è¿™é‡Œçš„tscoreå°±ä¼šå‚¨å­˜ä¸€ä¸ªå°†åŸæ¥çš„budgetçš„æ¯ä¸ªé¡¹ç›®è®¡ç®—åçš„ç»“æœã€‚
åŒæ ·è¿”å›ä¸€ä¸ªseriesã€‚

**è®¡ç®—æ˜¯åŸºäºnumpyçš„ï¼Œseriesçš„method**
**.sort_values æ˜¯pandasçš„method**

![[src/img/Pasted image 20220528134744.png|500]]
![[src/img/Pasted image 20220528134828.png|500]]

å†™å…¥æ–‡ä»¶ã€‚
.to_csv('fileName.csv',header= False) 
**pandasçš„method**
```py
budget.to_csv('holleywood_budget.csv', header=False)  
#holleywood_budget.csvã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¦ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹

```


## â“è‹¥æœ‰ç–‘é—®æƒ³ç¡®è®¤
å¯ä»¥åœ¨åé¢è·Ÿä¸€ä¸ªï¼Ÿ
å°±ä¼šoutputä¸€äº›æ–‡æ¡£è¯´æ˜å‡ºæ¥
input:
```py
budget.index.str.match?
```
output:
```py
Signature: budget.index.str.match(pat, case=True, flags=0, na=nan)
Docstring:
Determine if each string starts with a match of a regular expression.

Parameters
----------
pat : str
    Character sequence or regular expression.
case : bool, default True
    If True, case sensitive.
flags : int, default 0 (no flags)
    Regex module flags, e.g. re.IGNORECASE.
na : default NaN
    Fill value for missing values.

Returns
...
```


## ç»˜åˆ¶

```py
budget.plot(kind='bar', title='2015ã‚¢ã‚«ãƒ‡ãƒŸãƒ¼ä½œå“è³ãƒãƒŸãƒãƒ¼ãƒˆæ˜ ç”»ã®äºˆç®—') #ã‚°ãƒ©ãƒ•æç”»

```


# æ³¨æ„æ€è€ƒ
- è¿”å›çš„ä¸œè¥¿çš„æœ¬è´¨ã€‚æ¯”å¦‚ä½¿ç”¨seriesçš„å„ç§methodï¼Œè¿”å›çš„ä¸œè¥¿å¾ˆå¤šæœ¬è´¨ä¸Šä¹Ÿæ˜¯serieså¯¹è±¡ã€‚

- UnicodeDecodeError: 'utf-8' codec can't decode byte 0x83 in position 0: invalid start byte

- å‡½æ•°çš„å¥½å¤„ï¼š å¤šå¤„ä½¿ç”¨ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“è¯»ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚


# æ–¹æ¡ˆ

ãƒ¬ã‚·ãƒ”
https://www.youtube.com/watch?v=jFhCo6YAlHM

[è°ƒå‘³æ–™è®¡é‡å•ä½è½¬åŒ–](https://www.benricho.org/doryoko_cup_spoon/)